---
import { getUrl } from '../utils/url';
import { SUPPORTED_LANGUAGES, type Language, isValidLanguage } from '../i18n';

// Obtener preferencia de idioma en este orden:
// 1. Idioma del navegador (Accept-Language header)
// 2. Default (espaÃ±ol)

const getPreferredLanguage = (): Language => {
  const acceptLanguage = Astro.request.headers.get('accept-language') || '';
  
  // Parsear Accept-Language y buscar idioma soportado
  const preferredLangs = acceptLanguage
    .split(',')
    .map(lang => lang.split(';')[0].trim().split('-')[0].toLowerCase())
    .filter(lang => isValidLanguage(lang as Language));
  
  return preferredLangs.length > 0 
    ? (preferredLangs[0] as Language)
    : 'es';
};

const preferredLang = getPreferredLanguage();
const redirectUrl = getUrl(`/${preferredLang}/`);

return Astro.redirect(redirectUrl);
---

